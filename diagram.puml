' =========================================================
' DIAGRAM 1: CORE ARCHITECTURE (Class Diagram)
' =========================================================
@startuml architecture
title KitCat Core Data Model
skinparam style strictuml
skinparam packageStyle rectangle

package "Storage Layer (.kitcat/objects)" {
  class "Blob" as blob {
    + Content: []byte
    --
    Represents a file's content.
    Hashed by content (SHA-1).
  }

  class "Tree" as tree {
    + Entries: map[path]hash
    --
    Represents a directory structure.
    Maps file paths to Blob/Tree hashes.
  }

  class "Commit" as commit {
    + ID: string (Hash)
    + TreeHash: string
    + Parent: string (Commit ID)
    + Message: string
    + Author: string
    + Timestamp: time
    --
    Snapshot of the project at a time.
  }
}

package "Reference Layer (.kitcat/refs)" {
  class "Branch" as branch {
    + Name: string
    + Target: Commit ID
    --
    Stored in refs/heads/
  }
  
  class "HEAD" as head {
    + Ref: "refs/heads/main" 
    --
    Points to current Branch.
  }
}

head --> branch : points to
branch --> commit : references
commit --> tree : has root
tree --> blob : contains
tree --> tree : contains (subdirs)
commit --> commit : parent
@enduml
' ^^^ THIS WAS MISSING ^^^


' =========================================================
' DIAGRAM 2: ADD FLOW (Activity Diagram)
' =========================================================
@startuml flow-add
title Command: kitcat add
start
:Parse Arguments (File Path or --all);
if (Is --all?) then (yes)
  :Walk Working Directory;
  :Identify New, Modified, Deleted Files;
else (no)
  :Check specific file path;
endif

:Hash File Content (SHA-1);
:Store Blob in .kitcat/objects/;
:Load Current Index (.kitcat/index);
if (Hash exists in Index?) then (yes)
  :No change needed;
else (no)
  :Update Index Map
  (Path -> New Hash);
endif

:Save Index to Disk;
stop
@enduml


' =========================================================
' DIAGRAM 3: COMMIT FLOW (Activity Diagram)
' =========================================================
@startuml flow-commit
title Command: kitcat commit
start
:Load Index;
:Generate Tree Object
(Sort paths, content = "hash path");
:Hash Tree Content -> TreeHash;
:Store Tree in .kitcat/objects/;

:Load Parent Commit (HEAD);
if (TreeHash == ParentTreeHash?) then (yes)
  :Error: "Nothing to commit";
  stop
else (no)
  :Create Commit Object
  (Parent, TreeHash, Msg, Author);
  :Hash Commit -> CommitID;
  :Store Commit in .kitcat/commits.log;
endif

:Update Branch Reference
(Write CommitID to .kitcat/refs/heads/<branch>);
:Print Summary;
stop
@enduml
