@startuml commit
title Kitkat Commit Activity Diagram\n(internal/core/commit.go)
skinparam style strictuml
skinparam monochrome true
skinparam shadowing false
skinparam dpi 300
skinparam activityFontSize 10
skinparam noteFontSize 9

start
:User runs `kitkat commit <msg>`:;

:Load config\n(author.name/email):;

partition "1. Tree from Index" {
  :storage.CreateTree() -> TreeHash:;
  note right: Sort paths, store objects
}

partition "2. HEAD Comparison" {
  :GetHeadCommit() -> ParentTreeHash:;
}

if (TreeHash == ParentTreeHash?) then (yes)
  stop
  note right: "nothing to commit,\nworking tree clean"
else (no)
endif

partition "3. Create Commit" {
  :models.Commit\n(Parent,Tree,Msg,Time):;
  :hashCommit() -> ID:;
  :storage.AppendCommit():;
  note right: Future: objects/<ID>
}

partition "4. Update Branch" {
  :getCurrentBranchRefPath():;
  :WriteFile(refs/heads/main, ID):;
}

:Generate summary\n(oldTree vs newTree):;
stop
@enduml
