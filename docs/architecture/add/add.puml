@startuml add
title Command: kitcat add
skinparam style strictuml
start
:User runs `kitcat add ...`;
:Parse Arguments (File Path or --all);

if (Is --all?) then (yes)
  :Walk Working Directory;
  :Identify New, Modified, Deleted Files;
else (no)
  :Check specific file path;
  :Verify file is safe & accessible;
endif

partition "Object Storage" {
  :Read File Content;
  :Calculate SHA-1 Hash;
  :Store Blob in .kitcat/objects/<hash>;
}

partition "Index Update" {
  :Load Current Index (.kitcat/index);
  if (Hash in Index == New Hash?) then (yes)
    :No change needed;
  else (no)
    :Update Index Map
    (Path -> New Hash);
  endif
  :Save Index to Disk;
}
stop
@enduml
