@startuml
title Command: kitcat status
skinparam style strictuml

start
:User runs `kitcat status`;

:Load HEAD Tree (Last Commit);
:Load Index (Staging Area);
:Load Ignore Patterns;

partition "Staged Changes (Index vs HEAD)" {

  :Iterate through Index entries;

  if (File exists in HEAD?) then (no)
    :Mark as New File (Staged);
  else (yes)
    if (Hash differs between Index and HEAD?) then (yes)
      :Mark as Modified (Staged);
    endif
  endif

  if (File exists in HEAD but not in Index?) then (yes)
    :Mark as Deleted (Staged);
  endif
}

partition "Unstaged & Untracked (Working Directory vs Index)" {

  :Walk Working Directory
  (filepath.Walk);

  if (File exists in Index?) then (yes)
    if (Content hash differs from Index?) then (yes)
      :Mark as Modified (Unstaged);
    endif
  else (no)
    if (Is File Ignored?) then (yes)
      :Skip;
    else (no)
      :Mark as Untracked;
    endif
  endif
}

partition "Unstaged Deletions (Index vs Working Directory)" {
  :Iterate through Index entries;
  if (File exists in Working Directory?) then (no)
    :Mark as Deleted (Unstaged);
  endif
}

stop
@enduml
